<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Login First</title>
    <script type="module">
      // âœ… Import Firebase v12.2.1
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithRedirect, getRedirectResult } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

      // ðŸ”‘ Replace with your Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyCHaNnkWhDHPo4Rrm_7cEjlO7G1zhuLPxU",
Â Â authDomain: "kikasite-251f4.firebaseapp.com",
Â Â projectId: "kikasite-251f4",
Â Â storageBucket: "kikasite-251f4.firebasestorage.app",
Â Â messagingSenderId: "1061899209288",
Â Â appId: "1:1061899209288:web:8630fb47b7b3ded399667d",
Â Â measurementId: "G-5FR0E8HTDG"

      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      // âœ… Login with redirect
      async function login() {
        await signInWithRedirect(auth, provider);
      }
      window.login = login; // expose globally

      // âœ… After redirect back, check login result
      getRedirectResult(auth).then((result) => {
        if (result?.user) {
          const user = {
            name: result.user.displayName,
            email: result.user.email,
            photo: result.user.photoURL
          };
          localStorage.setItem("user", JSON.stringify(user));

          // load React app
          const script = document.createElement("script");
          script.type = "module";
          script.src = "/src/main.tsx";
          document.body.appendChild(script);

          // hide login page
          const loginDiv = document.getElementById("login-page");
          if (loginDiv) loginDiv.style.display = "none";
        } else {
          // if already stored in localStorage, load app
          const storedUser = localStorage.getItem("user");
          if (storedUser) {
            const script = document.createElement("script");
            script.type = "module";
            script.src = "/src/main.tsx";
            document.body.appendChild(script);
            const loginDiv = document.getElementById("login-page");
            if (loginDiv) loginDiv.style.display = "none";
          }
        }
      }).catch((error) => {
        console.error("Login failed:", error);
        if (error.code === "auth/unauthorized-domain") {
          alert("Your domain is not authorized in Firebase Console. Add it in Authentication â†’ Settings â†’ Authorized Domains.");
        }
      });
    </script>
  </head>
  <body>
    <div id="login-page">
      <button onclick="login()">Login with Google</button>
    </div>
    <div id="root"></div>
  </body>
</html>
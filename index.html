<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Firebase Google SignIn — Bootstrap</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <div class="card mx-auto" style="max-width:540px;">
      <div class="card-body text-center">
        <h3 class="card-title">Sign in with Google</h3>
        <div id="user-area" class="mt-3">
          <!-- populated by JS -->
          <button id="loginBtn" class="btn btn-outline-primary">Sign in with Google</button>
        </div>
        <div id="status" class="mt-3 text-muted small"></div>
      </div>
    </div>
  </div>

  <!-- Firebase modular SDK via CDN (works in modern browsers). If Firebase console gave you a snippet, you may use that instead. -->
  <script type="module">
    // ------------- replace with the firebaseConfig object from your Firebase console -------------
    const firebaseConfig = {
      apiKey: "AIzaSyCHaNnkWhDHPo4Rrm_7cEjlO7G1zhuLPxU",
  authDomain: "kikasite-251f4.firebaseapp.com",
  projectId: "kikasite-251f4",
  storageBucket: "kikasite-251f4.firebasestorage.app",
  messagingSenderId: "1061899209288",
  appId: "1:1061899209288:web:8630fb47b7b3ded399667d",
  measurementId: "G-5FR0E8HTDG"

    };
    // -------------------------------------------------------------------------------------------

    // Import modular SDK functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signOut,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    // Initialize
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // UI refs
    const loginBtn = document.getElementById('loginBtn');
    const userArea = document.getElementById('user-area');
    const status = document.getElementById('status');

    loginBtn.onclick = () => signInWithGoogle();

    async function signInWithGoogle() {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        // Save/update user info in Firestore under collection "users" with doc id = uid
        await setDoc(doc(db, "users", user.uid), {
          uid: user.uid,
          name: user.displayName || null,
          email: user.email || null,
          photoURL: user.photoURL || null,
          lastSeen: serverTimestamp()
        }, { merge: true });

        status.textContent = 'Signed in and saved profile to Firestore.';
      } catch (err) {
        console.error("Sign in error:", err);
        status.textContent = 'Sign in failed: ' + err.message;
      }
    }

    async function signOutUser() {
      await signOut(auth);
      status.textContent = 'Signed out.';
    }

    // Update UI on auth state change
    onAuthStateChanged(auth, async user => {
      if (user) {
        // get profile from Firestore (optional)
        const snap = await getDoc(doc(db, "users", user.uid));
        const data = snap.exists() ? snap.data() : {};
        userArea.innerHTML = `
          <div class="d-flex align-items-center gap-3 justify-content-center">
            <img src="${user.photoURL || ''}" alt="avatar" class="rounded-circle" width="56" height="56" style="object-fit:cover;">
            <div class="text-start">
              <div><strong>${user.displayName || data.name || 'User'}</strong></div>
              <div class="small text-muted">${user.email || ''}</div>
            </div>
            <div>
              <button id="signOutBtn" class="btn btn-sm btn-outline-secondary">Sign out</button>
            </div>
          </div>
        `;
        document.getElementById('signOutBtn').onclick = signOutUser;
      } else {
        userArea.innerHTML = `<button id="loginBtn" class="btn btn-outline-primary">Sign in with Google</button>`;
        document.getElementById('loginBtn').onclick = signInWithGoogle;
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
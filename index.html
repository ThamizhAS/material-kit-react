<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Login First</title>
    <script type="module">
      // use version 12.2.1 from CDN
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
      import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCHaNnkWhDHPo4Rrm_7cEjlO7G1zhuLPxU",
  authDomain: "kikasite-251f4.firebaseapp.com",
  projectId: "kikasite-251f4",
  storageBucket: "kikasite-251f4.firebasestorage.app",
  messagingSenderId: "1061899209288",
  appId: "1:1061899209288:web:8630fb47b7b3ded399667d",
  measurementId: "G-5FR0E8HTDG"

      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const provider = new GoogleAuthProvider();

      async function login() {
        try {
          const result = await signInWithPopup(auth, provider);
          const user = {
            name: result.user.displayName,
            email: result.user.email,
            photo: result.user.photoURL
          };
          localStorage.setItem("user", JSON.stringify(user));

          // dynamically load React app
          const script = document.createElement("script");
          script.type = "module";
          script.src = "/src/main.tsx";
          document.body.appendChild(script);

          // optional: hide the login button or login UI
          const loginDiv = document.getElementById("login-page");
          if (loginDiv) loginDiv.style.display = "none";
        } catch (error) {
          console.error("Login failed:", error);
        }
      }

      window.login = login;

      // If already logged in, load app immediately
      const storedUser = localStorage.getItem("user");
      if (storedUser) {
        const script = document.createElement("script");
        script.type = "module";
        script.src = "/src/main.tsx";
        document.body.appendChild(script);

        const loginDiv = document.getElementById("login-page");
        if (loginDiv) loginDiv.style.display = "none";
      }
    </script>
  </head>
  <body>
    <div id="login-page">
      <button onclick="login()">Login with Google</button>
    </div>
    <div id="root"></div>
  </body>
</html>